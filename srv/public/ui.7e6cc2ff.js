!function(e,n,t,o,i){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r="function"==typeof a[o]&&a[o],s=r.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(n,t){if(!s[n]){if(!e[n]){var i="function"==typeof a[o]&&a[o];if(!t&&i)return i(n,!0);if(r)return r(n,!0);if(l&&"string"==typeof n)return l(n);var c=Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}d.resolve=function(t){var o=e[n][1][t];return null!=o?o:t},d.cache={};var m=s[n]=new u.Module(n);e[n][0].call(m.exports,d,m,m.exports,this)}return s[n].exports;function d(e){var n=d.resolve(e);return!1===n?{}:u(n)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=s,u.parent=r,u.register=function(n,t){e[n]=[function(e,n){n.exports=t},{}]},Object.defineProperty(u,"root",{get:function(){return a[o]}}),a[o]=u;for(var c=0;c<n.length;c++)u(n[c])}({isQMz:[function(e,n,t){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(t),o.export(t,"UIScene",()=>u);var i=e("@/game_state/ui/state"),a=e("@/utils/clear_utils"),r=e("@babylonjs/core"),s=e("./html/ui_components"),l=e("./spin2");function u(){let e=new r.Scene(i.UISTATE.Engine);e.clearColor=new r.Color4(1,1,1,0),e.ambientColor=new r.Color3(1,1,1);let n=new r.UniversalCamera("ui-camera",new r.Vector3(0,18,15),e);n.fov=(0,r.Tools).ToRadians(70),n.target=new r.Vector3(0,0,0),i.UISTATE.Camera=n;let t=new r.HemisphericLight("ui-light",new r.Vector3(0,1,0),e);t.diffuse=new r.Color3(.5,.5,.5),t.specular=new r.Color3(0,0,0),t.intensity=0;let o=new r.SpotLight("spot-1",new r.Vector3(0,30,0),new r.Vector3(0,-1,0),(0,r.Tools).ToRadians(50),30,e);o.diffuse=new r.Color3(1,1,1),o.specular=new r.Color3(1,1,1),o.intensity=.9,function(e){let n=(0,a.getInnerWindow)(),t=(0,r.MeshBuilder).CreateGround("ground",{width:n.width,height:n.height},e);t.receiveShadows=!0;let o=new r.StandardMaterial("ground-mt",e);o.diffuseColor=new r.Color3(.1,.1,.3),o.maxSimultaneousLights=10,t.material=o}(e),e.onReadyObservable.add(()=>{(0,s.backSetOpaq_0)(),(0,l.spinMenu2)(e)}),i.UISTATE.Scene=e}},{"@/game_state/ui/state":"aE8EP","@/utils/clear_utils":"aFozW","@babylonjs/core":"1KKys","./html/ui_components":"7Tzis","./spin2":"55nRH","@parcel/transformer-js/src/esmodule-helpers.js":"XTfsy"}],"55nRH":[function(e,n,t){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(t),o.export(t,"SPINMENU",()=>d),o.export(t,"spinMenu2",()=>f),o.export(t,"rotateToNextPosition",()=>b),o.export(t,"rotateToPrevPosition",()=>T);var i=e("@/game_state/assets/state"),a=e("@/game_state/game_state"),r=e("@/utils/loaderGlbFiles"),s=e("@babylonjs/core"),l=e("./html/ui_components"),u=e("@/DB/indexdb"),c=e("@/utils/clear_utils");let m={border:null,center:null,level:null,numbers:new Map},d={nodeMenu:null,count:6,radius:14,position:new s.Vector3(0,0,15),angle:0,angleDelta:0,focusItem:null,items:new Map,scaleDeterminant:.6,scaleDeterminantMax:1.5,isFocusItemHover:!1,isLeaveMenu:!0,hoverMaterial:null,standardMaterial:null,hoverParticles:null};async function f(e){let n=!1,t=null;d.standardMaterial=new s.StandardMaterial("standard-item-mt",e),d.standardMaterial.diffuse=new s.Color3(.2,.2,.2),d.nodeMenu=await function(e,n,t,o){let i=new s.TransformNode("menu-tn",o);d.angle=360/t,d.angleDelta=1.5*d.angle;let a=[];return[...Array(t).keys()].forEach(e=>{a.push(w(`item-${e}`,{index:e,angle:d.angle*e+d.angleDelta},o))}),new Promise(t=>{Promise.all(a).then(o=>{o.forEach((e,t)=>{var o;d.items.set(t,e),e.scalingDeterminant=d.scaleDeterminant,e.setParent(i),o=new s.Vector3(Math.cos((0,s.Tools).ToRadians(d.angle*t))*n,0,Math.sin((0,s.Tools).ToRadians(d.angle*t))*n),e.position=o}),i.rotation.y=(0,s.Tools).ToRadians(d.angleDelta),i.position=e,t(i)})})}(d.position,d.radius,d.count,e),g(0,d.nodeMenu,e),(0,u.getResultsIDB)().then(e=>{let n=e.filter(e=>d.focusItem.meta.index===e.level),t=n[0];for(let e=1;e<n.length;e++)t.score<n[e].score&&(t=n[e]);t?(0,l.redrawResult)(t.isWin,t.score):(0,l.redrawResult)(!1,0),(0,l.showResult)(!0)}),(0,l.redrawLevelDescription)(1,0,a.GameState.state.lang),(0,l.showDescription)(!0),function(e,n){let t=document.querySelector(".left-menu-button"),o=document.querySelector(".right-menu-button");t.addEventListener("click",()=>{T(e,n)}),o.addEventListener("click",()=>{b(e,n)}),(0,l.showSpinMenuButtons)(!0)}(d.nodeMenu,e),e.onPointerDown=(o,i,r)=>{let s=e.pick(e.pointerX,e.pointerY,()=>!0);s.pickedMesh.name.includes("moveHandler")&&(n?((0,a.GameState).levelRun(d.focusItem.meta.index),n=!1):(n=!0,t=s.pickedPoint))},e.onPointerMove=(o,i,a)=>{if(function(e){let n=e.pick(e.pointerX,e.pointerY,()=>!0);if(n.pickedMesh){if("moveHandler"===n.pickedMesh.name){let n=d.focusItem.getChildMeshes().filter(e=>"center"===e.name)[0];d.isFocusItemHover||(d.isFocusItemHover=!0,d.isLeaveMenu=!1,d.hoverParticles=(0,c.appendParticles)(`${d.focusItem.name}-particles`,n,{color1:new s.Color4(.4,.4,.1,.5),color2:new s.Color4(.5,.3,.3,.3),color3:new s.Color4(.9,.2,.2,1),capacity:3e3,emitRate:1e3,max_size:.9,updateSpeed:.05,emmitBox:new s.Vector3(3,0,3),lifeTime:5,gravityY:1,isLocal:!0,sphere:{radius:3.5,range:1}},e),d.hoverParticles.start())}else d.isLeaveMenu||(d.focusItem.getChildMeshes().filter(e=>"center"===e.name)[0],d.hoverParticles.stop(),d.isFocusItemHover=!1,d.isLeaveMenu=!0)}}(e),n){let o=e.pick(e.pointerX,e.pointerY,()=>!0),i=t.x-o.pickedPoint.x;Math.abs(i)>5&&(i>0?b(d.nodeMenu,e):T(d.nodeMenu,e),n=!1)}},e.onPointerUp=(e,t,o)=>{n&&setTimeout(()=>{n=!1},300)}}function p(e,n,t){let o=new s.StandardMaterial("cil-mt",t);return o.diffuseColor=n.diffuse,o.specularColor=new s.Color3(.3,.4,1),o.ambientColor=new s.Color3(.01,.02,.1),o.roughness=0,o.specularPower=.5,o.twoSidedLighting=!0,o.alpha=n.alpha??1,e.material=o,e}async function h(e,n,t){return new Promise(o=>{(0,r.loadMenuItemModel)(t).then(()=>{(0,i.ASSETS).containers3D.get("menu_item").instantiateModelsToScene(e=>e).rootNodes[0].getChildMeshes().forEach(e=>{switch(e.isVisible=!1,e.isEnabled(!1),e.name){case"Border":m.border=e;break;case"Center":m.center=e;break;case"Level":m.level=e;break;case"number-0":case"number-1":case"number-2":case"number-3":case"number-4":case"number-5":case"number-6":case"number-7":case"number-8":case"number-9":m.numbers.set(e.name,e);break;default:console.log("switch default")}})}).then(()=>{let i=function(e,n,t){let o=new s.TransformNode(`${e}-${n.index}`,t),i=m.border.clone("border");i.isVisible=!0,i.isEnabled(!0);let a=m.center.clone("center");a.isVisible=!0,a.isEnabled(!0);let r=m.level.clone("level");r.isVisible=!0,r.isEnabled(!0);let l=m.numbers.get(`number-${n.index}`).clone(`number-${n.index}`);l.isVisible=!0,l.isEnabled(!0);let u=m.center.clone("moveHandler");return u.isVisible=!0,u.isEnabled(!0),a.scaling=new s.Vector3(.9,.2,.9),u.scaling=new s.Vector3(1.1,.1,1.1),u.position.y=2,u.position.z+=1.3,l.rotation.y=(0,s.Tools).ToRadians(180),l.position.z=.9,r.rotation.y=(0,s.Tools).ToRadians(0),r.position=new s.Vector3(0,1.4,-.5),a.position.y=0,i.position.y=.3,l.position=new s.Vector3(0,1.1,1.7),i.setParent(o),a.setParent(o),r.setParent(o),l.setParent(o),u.setParent(o),p(i,{diffuse:new s.Color3(.5,.3,.2)},t),p(a,{diffuse:new s.Color3(.2,.2,.2),alpha:.1},t),p(r,{diffuse:new s.Color3(.9,.9,.9)},t),p(l,{diffuse:new s.Color3(.7,.7,.7)},t),p(u,{diffuse:new s.Color3(.1,.01,.01),alpha:0},t),o.scalingDeterminant=1.5,o.position.y=1,o}(e,{index:n.index},t);i.position=new s.Vector3(0,14,0),o(i)})})}async function w(e,n,t){return new Promise(o=>{h(e,{index:n.index},t).then(t=>{t.meta={name:e,index:n.index,angle:n.angle},o(t)})})}function g(e,n,t){let o=d.items.get(e),i=d.focusItem;o.rotation.y=(0,s.Tools).ToRadians(-o.meta.angle);let a=(0,s.Tools).ToRadians(o.meta.angle);i&&(390===i.meta.angle&&90===o.meta.angle&&(n.rotation.y=(0,s.Tools).ToRadians(30)),90===i.meta.angle&&390===o.meta.angle&&(n.rotation.y=(0,s.Tools).ToRadians(450)));let r=function(e,n){let t=[{frame:0,value:e.rotation.clone().y},{frame:120,value:n}],o=new s.Animation("rotate-menu-anim","rotation.y",120,s.Animation.ANIMATIONTYPE_FLOAT,s.Animation.ANIMATIONLOOPMODE_CONSTANT,!1);return o.setKeys(t),e.animations.push(o),o}(n,a);t.beginAnimation(n,0,120,!1,2,()=>{t.removeAnimation(r)});let c=M(o),m=v(o);if(t.beginAnimation(o,0,60,!1,2,()=>{t.removeAnimation(c),t.removeAnimation(m)}),i){let e=M(i),n=v(i);t.beginAnimation(i,60,0,!1,2,()=>{t.removeAnimation(e),t.removeAnimation(n)})}(0,l.redrawLevelDescription)(1,e,"ru"),(0,u.getResultsIDB)().then(e=>{let n=e.filter(e=>d.focusItem.meta.index===e.level),t=n[0];for(let e=1;e<n.length;e++)t.score<n[e].score&&(t=n[e]);t?(0,l.redrawResult)(t.isWin,t.score):(0,l.redrawResult)(!1,0),(0,l.showResult)(!0)}),d.focusItem=o}function b(e,n){let t=(d.focusItem?d.focusItem.meta.index:0)+1;g(t=t>=d.count?0:t,e,n)}function T(e,n){let t=(d.focusItem?d.focusItem.meta.index:0)-1;g(t=t<0?d.count-1:t,e,n)}function v(e){let n=[{frame:0,value:d.scaleDeterminant},{frame:60,value:d.scaleDeterminantMax}],t=new s.Animation("scale-menu-anim","scalingDeterminant",60,s.Animation.ANIMATIONTYPE_FLOAT,s.Animation.ANIMATIONLOOPMODE_CONSTANT,!1);return t.setKeys(n),e.animations.push(t),t}function M(e){let n=e.position.clone(),t=n.add(new s.Vector3(0,0,0)),o=new s.Animation("posY-menuanim","position",60,s.Animation.ANIMATIONTYPE_VECTOR3,s.Animation.ANIMATIONLOOPMODE_CONSTANT,!1);return o.setKeys([{frame:0,value:n},{frame:60,value:t}]),e.animations.push(o),o}},{"@/game_state/assets/state":"eemMA","@/game_state/game_state":"5qBSL","@/utils/loaderGlbFiles":"dfETV","@babylonjs/core":"1KKys","./html/ui_components":"7Tzis","@/DB/indexdb":"iS775","@/utils/clear_utils":"aFozW","@parcel/transformer-js/src/esmodule-helpers.js":"XTfsy"}]},[],0,"parcelRequire6b9f");